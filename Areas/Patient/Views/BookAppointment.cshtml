@{
    Layout = "~/Areas/Patient/Views/Shared/_Layout.cshtml";
}

<form action="/Patient/Patient/BookAppointment" method="post" id="appointmentForm">
    <!-- Hidden IDs -->
    <input type="hidden" name="PatientId" value="@ViewData["PatientId"]" />
    <input type="hidden" name="DoctorId" value="@ViewData["DoctorId"]" />

    <div class="form-group">
        <label>Appointment Date</label>
        <input type="datetime-local" name="AppointmentDate" class="form-control" required />
    </div>

    <div class="form-group">
        <label>Reason for Visit</label>
        <textarea name="ReasonForVisit" class="form-control"></textarea>
    </div>

    <div class="form-group">
        <label>Payment Amount</label>
        <input type="number" step="0.01" id="PaymentAmount" name="PaymentAmount" class="form-control" required />
    </div>

    <button type="button" class="btn btn-primary" onclick="simulatePayment()">Book Appointment</button>
</form>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    function simulatePayment() {
        let amount = document.getElementById("PaymentAmount").value;

        if (!amount || amount <= 0) {
            alert("Please enter a valid amount");
            return;
        }

        let reference = prompt("Payment request sent to PhonePe.\nEnter Transaction ID to confirm:");

        if (reference && reference.trim() !== "") {
            let form = $("#appointmentForm");

            // add PaymentStatus dynamically
            $("<input>").attr({
                type: "hidden",
                name: "PaymentStatus",
                value: 1
            }).appendTo(form);

            $.ajax({
                url: '@Url.Action("BookAppointment", "Patient", new { area = "Patient" })',
                type: "POST",
                data: form.serialize(),
                success: function (response) {
                    console.log(response);
                    alert("Appointment booked successfully!");
                    //window.location.href = "/Patient/Patient/Index"; 
                },
                error: function () {
                    alert("Something went wrong! Please try again.");
                }
            });
        } else {
            alert("Payment Failed! Try again.");
        }
    }
</script>